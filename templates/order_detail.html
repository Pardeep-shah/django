{% extends 'base.html' %} {% load static %} {% block content %}
<div class="container py-5">
  <!-- Order Summary Card -->
  <div class="card shadow-lg mb-4 border-primary">
    <div class="card-header bg-primary text-white">
      <h2 class="h4 mb-0">Order #{{ order.id }}</h2>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-calendar-check fs-4 me-3 text-primary"></i>
            <div>
              <h6 class="mb-0">Order Date</h6>
              <p class="mb-0">{{ order.created_at|date:"F j, Y" }}</p>
            </div>
          </div>
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-credit-card fs-4 me-3 text-primary"></i>
            <div>
              <h6 class="mb-0">Payment Method</h6>
              <p class="mb-0">{{ order.payment_method }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-truck fs-4 me-3 text-primary"></i>
            <div>
              <h6 class="mb-0">Shipping Status</h6>
              <p
                class="mb-0 badge bg-{% if order.status == 'Completed' %}success{% elif order.status == 'Processing' %}warning{% else %}info{% endif %}"
              >
                {{ order.status }}
              </p>
            </div>
          </div>
          <div class="d-flex align-items-center">
            <i class="bi bi-geo-alt fs-4 me-3 text-primary"></i>
            <div>
              <h6 class="mb-0">Shipping Address</h6>
              <p class="mb-0">{{ order.shipping_address }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Items Section -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-light">
      <h3 class="h5 mb-0">Order Items</h3>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col" width="80px">Product</th>
              <th scope="col">Item</th>
              <th scope="col" class="text-end">Price</th>
              <th scope="col" class="text-center">Quantity</th>
              <th scope="col" class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for item in order.items.all %}
            <tr>
              <td>
                <img
                  src="{{ item.product.image.url }}"
                  alt="{{ item.product.name }}"
                  class="img-fluid rounded"
                  style="max-height: 60px"
                />
              </td>
              <td>
                <h6 class="mb-1">{{ item.product.name }}</h6>
                <small class="text-muted"
                  >{{ item.product.category.name }}</small
                >
              </td>
              <td class="text-end">${{ item.price }}</td>
              <td class="text-center">{{ item.quantity }}</td>
              <td class="text-end fw-bold">${{ item.get_total }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Order Totals -->
  <div class="row">
    <div class="col-lg-5 ms-auto">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title mb-3">Order Summary</h5>
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <span>${{ order.get_cart_total }}</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Shipping:</span>
            <span>${{ order.shipping_cost }}</span>
          </div>
          {% if order.discount_amount > 0 %}
          <div class="d-flex justify-content-between mb-2 text-success">
            <span>Discount:</span>
            <span>-${{ order.discount_amount }}</span>
          </div>
          {% endif %}
          <hr />
          <div class="d-flex justify-content-between fw-bold fs-5">
            <span>Total:</span>
            <span>${{ order.get_final_total }}</span>
          </div>
        </div>
        <div class="card-footer bg-light">
          <div class="d-grid gap-2">
            <a
              href="{% url 'send_invoice' %}?order_id={{ order.id }}"
              class="btn btn-outline-primary"
            >
              <i class="bi bi-envelope-paper me-2"></i>Email Invoice
            </a>
            <a href="{% url 'shop_now_page' %}" class="btn btn-primary">
              <i class="bi bi-bag me-2"></i>Continue Shopping
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tracking Timeline -->
  {% if order.status != 'Completed' %}
  <div class="card shadow-sm mt-4">
    <div class="card-header bg-light">
      <h3 class="h5 mb-0">Order Tracking</h3>
    </div>
    <div class="card-body">
      <div class="steps">
        <div
          class="step {% if order.status == 'Processing' %}active{% endif %}"
        >
          <div class="step-icon">
            <i class="bi bi-cart-check"></i>
          </div>
          <p class="step-text">Order Placed</p>
        </div>
        <div class="step {% if order.status == 'Shipped' %}active{% endif %}">
          <div class="step-icon">
            <i class="bi bi-box-seam"></i>
          </div>
          <p class="step-text">Shipped</p>
        </div>
        <div
          class="step {% if order.status == 'On The Way' %}active{% endif %}"
        >
          <div class="step-icon">
            <i class="bi bi-truck"></i>
          </div>
          <p class="step-text">On The Way</p>
        </div>
        <div class="step {% if order.status == 'Delivered' %}active{% endif %}">
          <div class="step-icon">
            <i class="bi bi-house-check"></i>
          </div>
          <p class="step-text">Delivered</p>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<style>
  .steps {
    display: flex;
    justify-content: space-between;
    position: relative;
  }

  .steps::before {
    content: "";
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 2px;
    background-color: #dee2e6;
    z-index: 1;
  }

  .step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
    flex: 1;
  }

  .step-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
    color: #6c757d;
  }

  .step.active .step-icon {
    background-color: #0d6efd;
    color: white;
  }

  .step-text {
    font-size: 0.875rem;
    color: #6c757d;
    text-align: center;
  }

  .step.active .step-text {
    color: #0d6efd;
    font-weight: 500;
  }
</style>
{% endblock %}
