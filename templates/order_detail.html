{% extends "base.html" %} {% load static %} {% block content %}
<div class="container py-5">
  <!-- Order Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="fw-bold text-primary mb-1">Order #{{ order.id }}</h1>
      <p class="text-muted mb-0">
        Placed on {{ order.created_at|date:"F j, Y \a\t g:i A" }}
      </p>
    </div>
    <div class="text-end">
      <a href="{% url 'my_orders' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-2"></i>Back to Orders
      </a>
      <a
        href="{% url 'send_invoice' %}?order_id={{ order.id }}"
        class="btn btn-primary ms-2"
      >
        <i class="bi bi-envelope-paper me-2"></i>Email Invoice
      </a>
    </div>
  </div>

  <!-- Order Status Card -->
  <div class="card shadow-sm mb-4 border-0 bg-gradient">
    <div class="card-body p-4">
      <div class="row align-items-center">
        <div class="col-md-8">
          <div class="d-flex align-items-center">
            <div class="me-4">
              <div class="bg-primary bg-opacity-10 p-3 rounded-circle">
                <i class="bi bi-box-seam-fill fs-3 text-primary"></i>
              </div>
            </div>
            <div>
              <h5 class="fw-bold mb-1">Order Status</h5>
              <div class="d-flex align-items-center">
                <span
                  class="badge {% if order.status == 'Completed' %}bg-success {% elif order.status == 'Pending' %}bg-warning text-dark {% elif order.status == 'Cancelled' %}bg-danger {% else %}bg-info{% endif %} fs-6 me-3"
                >
                  {{ order.status }}
                </span>
                {% if order.status == 'Pending' %}
                <small class="text-muted">Your order is being processed</small>
                {% elif order.status == 'Completed' %}
                <small class="text-muted"
                  >Delivered on {{ order.updated_at|date:"F j, Y" }}</small
                >
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4 text-md-end mt-3 mt-md-0">
          <h3 class="fw-bold text-primary">₹{{ order.total_amount }}</h3>
          <small class="text-muted">Total Paid</small>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Order Items -->
    <div class="col-lg-8 mb-4 mb-lg-0">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white border-0 py-3">
          <h5 class="fw-bold mb-0">Order Items</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table mb-0">
              <thead class="bg-light">
                <tr>
                  <th class="py-3 px-4" style="width: 60px">#</th>
                  <th class="py-3 px-4">Product</th>
                  <th class="py-3 px-4 text-center">Quantity</th>
                  <th class="py-3 px-4 text-end">Price</th>
                </tr>
              </thead>
              <tbody>
                {% for item in order.items.all %}
                <tr>
                  <td class="py-3 px-4 align-middle">{{ forloop.counter }}</td>
                  <td class="py-3 px-4 align-middle">
                    <div class="d-flex align-items-center">
                      <img
                        src="{{ item.product.image.url }}"
                        alt="{{ item.product.name }}"
                        class="rounded me-3"
                        width="60"
                        height="60"
                      />
                      <div>
                        <h6 class="mb-1 fw-bold">{{ item.product.name }}</h6>
                        <small class="text-muted"
                          >SKU: {{ item.product.sku }}</small
                        >
                      </div>
                    </div>
                  </td>
                  <td class="py-3 px-4 align-middle text-center">
                    {{ item.quantity }}
                  </td>
                  <td class="py-3 px-4 align-middle text-end fw-bold">
                    ₹{{ item.price }}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="col-lg-4">
      <div class="card shadow-sm border-0 sticky-top" style="top: 20px">
        <div class="card-header bg-white border-0 py-3">
          <h5 class="fw-bold mb-0">Order Summary</h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <h6 class="fw-bold mb-3">Payment Information</h6>
            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Payment Method:</span>
              <span class="fw-bold">{{ order.payment_method }}</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Payment Status:</span>
              <span class="badge bg-success">Paid</span>
            </div>
          </div>

          <hr class="my-3" />

          <div class="mb-3">
            <h6 class="fw-bold mb-3">Shipping Information</h6>
            <div class="mb-2">
              <p class="mb-1 fw-bold">{{ order.shipping_address.full_name }}</p>
              <p class="mb-1 text-muted small">
                {{ order.shipping_address.address_line1 }}
              </p>
              {% if order.shipping_address.address_line2 %}
              <p class="mb-1 text-muted small">
                {{ order.shipping_address.address_line2 }}
              </p>
              {% endif %}
              <p class="mb-1 text-muted small">
                {{ order.shipping_address.city }}, {{
                order.shipping_address.state }} - {{
                order.shipping_address.postal_code }}
              </p>
              <p class="mb-0 text-muted small">
                {{ order.shipping_address.phone }}
              </p>
            </div>
          </div>

          <hr class="my-3" />

          <div>
            <h6 class="fw-bold mb-3">Order Total</h6>
            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Subtotal:</span>
              <span>₹{{ order.subtotal }}</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Shipping:</span>
              <span>₹{{ order.shipping_cost }}</span>
            </div>
            {% if order.discount_amount > 0 %}
            <div class="d-flex justify-content-between mb-2 text-success">
              <span class="text-muted">Discount:</span>
              <span>-₹{{ order.discount_amount }}</span>
            </div>
            {% endif %}
            <div
              class="d-flex justify-content-between fw-bold mt-3 pt-2 border-top"
            >
              <span>Total:</span>
              <span class="text-primary">₹{{ order.total_amount }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Actions -->
  <div class="mt-4">
    <div class="card shadow-sm border-0">
      <div class="card-body p-4">
        <h5 class="fw-bold mb-3">Need Help With Your Order?</h5>
        <div class="row">
          <div class="col-md-4 mb-3 mb-md-0">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <i class="bi bi-headset fs-3 text-primary"></i>
              </div>
              <div>
                <h6 class="fw-bold mb-1">Customer Support</h6>
                <p class="mb-0 small text-muted">
                  Contact us for any questions
                </p>
                <a
                  href="{% url 'contact_us_page' %}"
                  class="btn btn-link p-0 small"
                  >Contact Us</a
                >
              </div>
            </div>
          </div>
          {% if order.status == 'Pending' %}
          <div class="col-md-4 mb-3 mb-md-0">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <i class="bi bi-x-circle fs-3 text-danger"></i>
              </div>
              <div>
                <h6 class="fw-bold mb-1">Cancel Order</h6>
                <p class="mb-0 small text-muted">Request order cancellation</p>
                <button
                  class="btn btn-link p-0 small"
                  data-bs-toggle="modal"
                  data-bs-target="#cancelOrderModal"
                >
                  Cancel Order
                </button>
              </div>
            </div>
          </div>
          {% endif %}
          <div class="col-md-4">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <i class="bi bi-printer fs-3 text-secondary"></i>
              </div>
              <div>
                <h6 class="fw-bold mb-1">Print Invoice</h6>
                <p class="mb-0 small text-muted">Save or print your invoice</p>
                <a
                  href="{% url 'show_invoice' %}?order_id={{ order.id }}"
                  class="btn btn-link p-0 small"
                  target="_blank"
                >
                  View Invoice
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Cancel Order Modal -->
<div
  class="modal fade"
  id="cancelOrderModal"
  tabindex="-1"
  aria-labelledby="cancelOrderModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cancelOrderModalLabel">Cancel Order</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p>
          Are you sure you want to cancel this order? This action cannot be
          undone.
        </p>
        <p class="fw-bold">Order #{{ order.id }} - ₹{{ order.total_amount }}</p>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          Close
        </button>
        {% comment %}
        <form method="post" action="{% url 'cancel_order' order.id %}">
          {% endcomment %} {% csrf_token %}
          <button type="submit" class="btn btn-danger">
            Confirm Cancellation
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_css %}
<style>
  .bg-gradient {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-left: 4px solid #0d6efd;
  }
  .table tbody tr:last-child td {
    border-bottom: none;
  }
  .badge {
    font-size: 0.85em;
    padding: 0.5em 0.75em;
  }
  .card {
    border-radius: 12px;
    overflow: hidden;
  }
  .card-header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }
</style>
{% endblock %} {% block extra_js %}
<script>
  // Add any JavaScript functionality you might need
  document.addEventListener("DOMContentLoaded", function () {
    // Example: Track when user views order details
    console.log("Order details viewed for order #{{ order.id }}");
  });
</script>
{% endblock %}
